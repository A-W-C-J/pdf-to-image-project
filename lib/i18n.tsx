"use client"

import { createContext, useContext, useState, useEffect, type ReactNode } from "react"

export type Language = "zh" | "en"

export const translations = {
  zh: {
    title: "PDF转图片工具 - 批量处理与OCR识别",
    subtitle: "支持批量转换、文字提取、页面合并、多格式输出的专业PDF处理工具",
    privacy: "专业PDF处理工具：支持PDF转图片、PDF转多种文档格式（Word、Markdown、LaTeX）、批量转换、OCR文字识别、页面合并、多格式输出、水印添加、可搜索PDF生成等功能",
    fileUpload: "文件上传",
    fileUploadDesc: "选择PDF文件或输入URL进行转换",
    localFile: "本地文件",
    urlInput: "URL输入",
    dragDrop: "拖拽文件到此处或点击选择",
    selected: "已选择",
    pdfUrl: "PDF链接",
    pdfUrlPlaceholder: "输入PDF文件的URL地址",
    pdfUrlDesc: "支持公开访问的PDF文件链接",
    urlReady: "URL已准备",
    fetchingPdf: "正在获取PDF文件...",
    invalidPdfUrl: "无效的PDF链接",
    pdfPassword: "PDF密码",
    pdfPasswordPlaceholder: "输入PDF文件密码",
    pdfPasswordDesc: "如果PDF文件受密码保护，请输入密码",
    passwordRequired: "此PDF文件需要密码",
    incorrectPassword: "密码错误，请重新输入",
    scale: "缩放比例",
    scaleDesc: "数值越大，图片质量越高，文件也越大",
    outputFormat: "输出格式",
    pngFormat: "PNG (无损压缩)",
    jpegFormat: "JPEG (有损压缩)",
    tiffFormat: "TIFF (无损压缩)",
    gifFormat: "GIF (动画格式)",
    bmpFormat: "BMP (位图格式)",
    addWatermark: "添加水印",
    watermarkText: "水印文字",
    watermarkTextPlaceholder: "输入水印内容",
    watermarkPosition: "水印位置",
    center: "居中",
    topLeft: "左上角",
    topRight: "右上角",
    bottomLeft: "左下角",
    bottomRight: "右下角",
    opacity: "透明度",
    startConvert: "开始转换",
    converting: "转换中...",
    loadingPdfjs: "正在加载PDF.js库...",
    readingPdf: "正在读取PDF文件...",
    parsingPdf: "正在解析PDF文档...",
    totalPages: "共",
    startConverting: "页，开始转换",
    convertingPage: "正在转换第",
    pageUnit: "页",
    convertComplete: "转换完成！共生成",
    images: "张图片",
    convertFailed: "转换失败",
    unknownError: "未知错误",
    selectValidPdf: "请选择有效的PDF文件",
    convertResult: "转换结果",
    downloadAll: "下载全部",
    download: "下载",
    page: "第",
    creatingZip: "正在创建ZIP文件...",
    downloadStarted: "下载已开始",
    downloadFailed: "下载失败",
    toggleTheme: "切换主题",
    lightTheme: "浅色主题",
    darkTheme: "深色主题",
    blog: "技术博客",
    blogTitle: "PDF处理技术博客",
    blogSubtitle: "分享PDF处理、格式转换、文档安全等技术知识和最佳实践",
    searchArticles: "搜索文章...",
    noArticlesFound: "没有找到相关文章",
    backToBlog: "返回博客",
    backToConverter: "返回转换器",
    share: "分享",
    viewMoreArticles: "← 查看更多文章",
    usePdfConverter: "使用PDF转换器 →",
    minRead: "分钟阅读",
    publishedOn: "发布于",
    mergePages: "合并页面",
    mergePagesDesc: "将所有页面合并为一张图片",
    pageSpacing: "页面间距",
    pageSpacingDesc: "页面之间的间距（像素）",
    mergeMargin: "边距",
    mergeMarginDesc: "合并图片的边距（像素）",
    maxWidth: "最大宽度",
    maxWidthDesc: "合并图片的最大宽度（像素）",
    maxHeight: "最大高度",
    maxHeightDesc: "合并图片的最大高度（像素）",
    mergingPages: "正在合并页面...",
    mergeComplete: "页面合并完成！",
    mergeError: "合并失败",
    mergeFailed: "合并失败",
    gifAutoMerge: "GIF格式将自动合并所有页面为动画",
    extractText: "提取文字",
    extractingText: "正在提取文字...",
    textExtracted: "文字提取完成",
    noTextFound: "未找到文字内容",
    copyText: "复制文字",
    downloadText: "下载文本",
    textCopied: "文字已复制到剪贴板",
    ocrLanguage: "识别语言",
    ocrLanguageDesc: "选择OCR文字识别语言",
    chinese: "中文",
    english: "英文",
    auto: "自动检测",
    searchablePdf: "可搜索PDF",
    searchablePdfDesc: "生成带有隐形文字层的可搜索PDF文档",
    generatingPdf: "正在生成PDF...",
    previewPdf: "预览PDF",
    pdfGenerated: "PDF生成完成",
    addBookmarks: "添加书签",
    preserveQuality: "保留图像质量",
    pdfOptions: "PDF选项",
    downloadSearchablePdf: "下载可搜索PDF",
    searchablePdfFormat: "可搜索PDF (OCR)",
    noImagesAvailable: "没有可用的图像",
    pdfGenerationFailed: "PDF生成失败",
    pdfAdvancedOptions: "PDF高级选项",
    ocrConfidenceThreshold: "OCR置信度阈值",
    ocrConfidenceDesc: "只有置信度高于此值的文字才会被包含在可搜索PDF中",
    fontSizeMultiplier: "字体大小倍数",
    fontSizeDesc: "调整PDF中文字层的字体大小",
    pageMargin: "页面边距",
    pageMarginDesc: "PDF页面的边距大小（像素）",
    textLayerOpacity: "文字层透明度",
    textLayerDesc: "文字层的透明度（0为完全透明，1为完全不透明）",
    enableTextSelection: "启用文字选择",
    textSelectionDesc: "允许在PDF中选择和复制文字",
    enableSummary: "启用AI总结",
    enableSummaryDesc: "使用本地AI模型对PDF内容进行智能总结",
    summaryOptions: "总结选项",
    summaryLanguage: "总结语言",
    summaryLanguageDesc: "选择总结输出的语言",
    summaryLength: "总结长度",
    summaryLengthDesc: "选择总结的详细程度",
    summaryShort: "简短",
    summaryMedium: "中等",
    summaryLong: "详细",
    generatingSummary: "正在生成总结...",
    summaryGenerated: "总结生成完成",
    summaryFailed: "总结生成失败",
    downloadSummary: "下载总结",
    copySummary: "复制总结",
    summaryCopied: "总结已复制到剪贴板",
    summaryResult: "总结结果",
    loadingModel: "正在加载AI模型...",
    modelLoaded: "AI模型加载完成",
    modelLoadFailed: "AI模型加载失败",
    // 认证相关翻译
    login: "登录",
    logout: "登出",
    loggingOut: "登出中...",
    register: "注册",
    loginAccount: "登录账户",
    registerAccount: "注册账户",
    loginDescription: "登录后可使用PDF转文档等高级功能",
    registerDescription: "创建账户以享受更多功能",
    noAccount: "没有账户？注册",
    hasAccount: "已有账户？登录",
    userAvatar: "用户头像",
    advancedFeatures: "高级功能",
    settings: "设置",
    logoutSuccess: "已成功登出",
    logoutFailed: "登出失败，请重试",
    loginRequired: "需要登录",
    loginRequiredDescription: "请先登录后再使用PDF转文档功能。",
    cancel: "取消",
    goToLogin: "去登录",
    authError: "认证失败",
    authErrorDescription: "登录过程中出现错误，请重试。",
    backToHome: "返回首页",
    retry: "重试",
    autoRedirectMessage: "10秒后将自动跳转到首页",
    tryAgain: "重新尝试",
    // 额度相关翻译
    remainingQuota: "剩余额度",
    pages: "页",
    loading: "加载中...",
    topup: "充值",
    quotaInsufficient: "额度不足",
    quotaInsufficientDesc: "您的PDF转文档额度不足，无法完成此次转换。请充值后再试。",
    // 充值页面翻译
    topupCenter: "充值中心",
    topupDescription: "购买PDF转换额度，享受更多专业功能",
    currentQuota: "当前额度",
    remainingPages: "剩余转换页数",
    professionalPlan: "专业版套餐",
    oneTimePurchase: "一次性购买，永久有效",
    recommended: "推荐",
    oneTimePayment: "一次性付费",
    pdfConversionQuota: "100页PDF转换额度",
    lifetimeAccess: "终身访问权限",
    professionalFeatures: "专业功能解锁",
    prioritySupport: "优先技术支持",
    processing: "处理中...",
    buyNow: "立即购买",
    securePayment: "安全支付由 Stripe 提供保障",
    freeFeatureNote: "• PDF转图片功能完全免费，无需额度",
    quotaFeatureNote: "• PDF转文档功能需要消耗相应页数的额度",
    permanentNote: "• 购买后额度永久有效，不会过期",
    pleaseLogin: "请先登录",
    createPaymentSessionFailed: "创建支付会话失败",
    noPaymentUrl: "未获取到支付链接",
    paymentProcessingFailed: "支付处理失败",
    loadingProducts: "加载产品信息中...",
    noAvailablePackages: "暂无可用的充值套餐",
    
    // 支付成功页面翻译
    paymentSuccess: "支付成功！",
    paymentSuccessDesc: "感谢您的购买，您的额度已成功充值",
    purchaseDetails: "购买详情",
    orderNumber: "订单号",
    purchasedPlan: "购买套餐",
    quotaReceived: "获得额度",
    paymentAmount: "支付金额",
    currentTotalQuota: "当前总额度",
    updatingQuota: "更新额度中...",
    availableForPdfConversion: "可用于PDF转文档功能",
    continueTopup: "继续充值",
    usageTips: "使用提示",
    quotaChargedTip: "• 您的额度已成功充值，可立即使用PDF转文档功能",
    quotaPermanentTip: "• 额度永久有效，不会过期",
    quotaConsumptionTip: "• 每转换一页PDF文档将消耗1页额度",
    freeFeatureTip: "• PDF转图片功能仍然完全免费",
  },
  en: {
    title: "PDF to Image Converter - Batch Processing & OCR",
    subtitle: "Professional PDF processing tool with batch conversion, text extraction, page merging, and multi-format output",
    privacy: "Professional PDF processing tool: supports PDF to image conversion, PDF to multiple document formats (Word, Markdown, LaTeX), batch processing, OCR text recognition, page merging, multi-format output, watermark addition, searchable PDF generation and more",
    fileUpload: "File Upload",
    fileUploadDesc: "Select PDF file or enter URL for conversion",
    localFile: "Local File",
    urlInput: "URL Input",
    dragDrop: "Drag and drop file here or click to select",
    selected: "Selected",
    pdfUrl: "PDF URL",
    pdfUrlPlaceholder: "Enter PDF file URL",
    pdfUrlDesc: "Supports publicly accessible PDF file links",
    urlReady: "URL Ready",
    fetchingPdf: "Fetching PDF file...",
    invalidPdfUrl: "Invalid PDF URL",
    pdfPassword: "PDF Password",
    pdfPasswordPlaceholder: "Enter PDF file password",
    pdfPasswordDesc: "If the PDF file is password protected, please enter the password",
    passwordRequired: "This PDF file requires a password",
    incorrectPassword: "Incorrect password, please try again",
    scale: "Scale",
    scaleDesc: "Higher values produce better quality but larger files",
    outputFormat: "Output Format",
    pngFormat: "PNG (Lossless)",
    jpegFormat: "JPEG (Lossy)",
    tiffFormat: "TIFF (Lossless)",
    gifFormat: "GIF (Animated)",
    bmpFormat: "BMP (Bitmap)",
    addWatermark: "Add Watermark",
    watermarkText: "Watermark Text",
    watermarkTextPlaceholder: "Enter watermark content",
    watermarkPosition: "Watermark Position",
    center: "Center",
    topLeft: "Top Left",
    topRight: "Top Right",
    bottomLeft: "Bottom Left",
    bottomRight: "Bottom Right",
    opacity: "Opacity",
    startConvert: "Start Convert",
    converting: "Converting...",
    loadingPdfjs: "Loading PDF.js library...",
    readingPdf: "Reading PDF file...",
    parsingPdf: "Parsing PDF document...",
    totalPages: "Total",
    startConverting: "pages, starting conversion",
    convertingPage: "Converting page",
    pageUnit: "",
    convertComplete: "Conversion complete! Generated",
    images: "images",
    convertFailed: "Conversion failed",
    unknownError: "Unknown error",
    selectValidPdf: "Please select a valid PDF file",
    convertResult: "Conversion Result",
    downloadAll: "Download All",
    download: "Download",
    page: "Page",
    creatingZip: "Creating ZIP file...",
    downloadStarted: "Download started",
    downloadFailed: "Download failed",
    toggleTheme: "Toggle theme",
    lightTheme: "Light Theme",
    darkTheme: "Dark Theme",
    blog: "Tech Blog",
    blogTitle: "PDF Processing Tech Blog",
    blogSubtitle:
      "Sharing technical knowledge and best practices on PDF processing, format conversion, and document security",
    searchArticles: "Search articles...",
    noArticlesFound: "No articles found",
    backToBlog: "Back to Blog",
    backToConverter: "Back to Converter",
    share: "Share",
    viewMoreArticles: "← View more articles",
    usePdfConverter: "Use PDF Converter →",
    minRead: "min read",
    publishedOn: "Published on",
    mergePages: "Merge Pages",
    mergePagesDesc: "Merge all pages into a single image",
    pageSpacing: "Page Spacing",
    pageSpacingDesc: "Spacing between pages (pixels)",
    mergeMargin: "Margin",
    mergeMarginDesc: "Margin of merged image (pixels)",
    maxWidth: "Max Width",
    maxWidthDesc: "Maximum width of merged image (pixels)",
    maxHeight: "Max Height",
    maxHeightDesc: "Maximum height of merged image (pixels)",
    mergingPages: "Merging pages...",
    mergeComplete: "Pages merged successfully!",
    mergeError: "Merge failed",
    mergeFailed: "merge failed",
    gifAutoMerge: "GIF format will automatically merge all pages into animation",
    extractText: "Extract Text",
    extractingText: "Extracting text...",
    textExtracted: "Text extraction completed",
    noTextFound: "No text content found",
    copyText: "Copy Text",
    downloadText: "Download Text",
    textCopied: "Text copied to clipboard",
    ocrLanguage: "OCR Language",
    ocrLanguageDesc: "Select OCR text recognition language",
    chinese: "Chinese",
    english: "English",
    auto: "Auto Detect",
    searchablePdf: "Searchable PDF",
    searchablePdfDesc: "Generate searchable PDF with invisible text layer",
    generatingPdf: "Generating PDF...",
    previewPdf: "Preview PDF",
    pdfGenerated: "PDF generated successfully",
    addBookmarks: "Add Bookmarks",
    preserveQuality: "Preserve Image Quality",
    pdfOptions: "PDF Options",
    downloadSearchablePdf: "Download Searchable PDF",
    searchablePdfFormat: "Searchable PDF (OCR)",
    noImagesAvailable: "No images available",
    pdfGenerationFailed: "PDF generation failed",
    pdfAdvancedOptions: "PDF Advanced Options",
    ocrConfidenceThreshold: "OCR Confidence Threshold",
    ocrConfidenceDesc: "Only text with confidence above this value will be included in searchable PDF",
    fontSizeMultiplier: "Font Size Multiplier",
    fontSizeDesc: "Adjust the font size of text layer in PDF",
    pageMargin: "Page Margin",
    pageMarginDesc: "Margin size of PDF pages (pixels)",
    textLayerOpacity: "Text Layer Opacity",
    textLayerDesc: "Opacity of text layer (0 for fully transparent, 1 for fully opaque)",
    enableTextSelection: "Enable Text Selection",
    textSelectionDesc: "Allow text selection and copying in PDF",
    enableSummary: "Enable AI Summary",
    enableSummaryDesc: "Use local AI model to generate intelligent summary of PDF content",
    summaryOptions: "Summary Options",
    summaryLanguage: "Summary Language",
    summaryLanguageDesc: "Select the language for summary output",
    summaryLength: "Summary Length",
    summaryLengthDesc: "Select the level of detail for summary",
    summaryShort: "Short",
    summaryMedium: "Medium",
    summaryLong: "Detailed",
    generatingSummary: "Generating summary...",
    summaryGenerated: "Summary generated successfully",
    summaryFailed: "Summary generation failed",
    downloadSummary: "Download Summary",
    copySummary: "Copy Summary",
    summaryCopied: "Summary copied to clipboard",
    summaryResult: "Summary Result",
    loadingModel: "Loading AI model...",
    modelLoaded: "AI model loaded successfully",
    modelLoadFailed: "AI model loading failed",
    // Authentication related translations
    login: "Login",
    logout: "Logout",
    loggingOut: "Logging out...",
    register: "Register",
    loginAccount: "Login Account",
    registerAccount: "Register Account",
    loginDescription: "Login to use advanced features like PDF to document conversion",
    registerDescription: "Create an account to enjoy more features",
    noAccount: "No account? Register",
    hasAccount: "Already have an account? Login",
    userAvatar: "User Avatar",
    advancedFeatures: "Advanced Features",
    settings: "Settings",
    logoutSuccess: "Successfully logged out",
    logoutFailed: "Logout failed, please try again",
    loginRequired: "Login Required",
    loginRequiredDescription: "Please log in first to use the PDF to document conversion feature.",
    cancel: "Cancel",
    goToLogin: "Go to Login",
    authError: "Authentication Failed",
    authErrorDescription: "An error occurred during login, please try again.",
    retry: "Retry",
    autoRedirectMessage: "Will automatically redirect to home page in 10 seconds",
    tryAgain: "Try Again",
    // Quota related translations
    remainingQuota: "Remaining Quota",
    pages: "pages",
    loading: "Loading...",
    topup: "Top Up",
    quotaInsufficient: "Insufficient Quota",
    quotaInsufficientDesc: "Your PDF conversion quota is insufficient to complete this conversion. Please recharge and try again.",
    // Top-up page translations
    topupCenter: "Top-up Center",
    topupDescription: "Purchase PDF conversion quota to enjoy more professional features",
    currentQuota: "Current Quota",
    remainingPages: "Remaining conversion pages",
    professionalPlan: "Professional Plan",
    oneTimePurchase: "One-time purchase, lifetime validity",
    recommended: "Recommended",
    oneTimePayment: "One-time payment",
    pdfConversionQuota: "100 pages PDF conversion quota",
    lifetimeAccess: "Lifetime access",
    professionalFeatures: "Professional features unlocked",
    prioritySupport: "Priority technical support",
    processing: "Processing...",
    buyNow: "Buy Now",
    securePayment: "Secure payment powered by Stripe",
    freeFeatureNote: "• PDF to image conversion is completely free, no quota required",
    quotaFeatureNote: "• PDF to document conversion requires corresponding page quota",
    permanentNote: "• Purchased quota is permanently valid and never expires",
    pleaseLogin: "Please log in first",
    createPaymentSessionFailed: "Failed to create payment session",
    noPaymentUrl: "No payment URL received",
    paymentProcessingFailed: "Payment processing failed",
    loadingProducts: "Loading products...",
    noAvailablePackages: "No available packages",
    
    // Payment success page translations
    paymentSuccess: "Payment Successful!",
    paymentSuccessDesc: "Thank you for your purchase, your quota has been successfully recharged",
    purchaseDetails: "Purchase Details",
    orderNumber: "Order Number",
    purchasedPlan: "Purchased Plan",
    quotaReceived: "Quota Received",
    paymentAmount: "Payment Amount",
    currentTotalQuota: "Current Total Quota",
    updatingQuota: "Updating quota...",
    availableForPdfConversion: "Available for PDF conversion",
    backToHome: "Back to Home",
    continueTopup: "Continue Top-up",
    usageTips: "Usage Tips",
    quotaChargedTip: "• Your quota has been successfully recharged and can be used immediately for PDF to document conversion",
    quotaPermanentTip: "• Quota is permanently valid and never expires",
    quotaConsumptionTip: "• Each page of PDF document conversion will consume 1 page quota",
    freeFeatureTip: "• PDF to image conversion remains completely free",
  },
} as const

export type TranslationKey = keyof typeof translations.zh

function detectBrowserLanguage(): Language {
  if (typeof window === "undefined") return "en" // Default for SSR

  const browserLang = navigator.language || navigator.languages?.[0] || "en"

  // Check if browser language starts with supported language codes
  if (browserLang.startsWith("zh")) return "zh"
  if (browserLang.startsWith("en")) return "en"

  // Default fallback
  return "en"
}

// Language Context
interface LanguageContextType {
  language: Language
  setLanguage: (language: Language) => void
  t: (key: TranslationKey) => string
}

const LanguageContext = createContext<LanguageContextType | undefined>(undefined)

export function LanguageProvider({ children }: { children: ReactNode }) {
  const [mounted, setMounted] = useState(false)
  const [language, setLanguage] = useState<Language>("en") // Default to English for SSR

  useEffect(() => {
    setMounted(true)
    // Check localStorage first, then browser language
    const saved = localStorage.getItem("preferred-language") as Language
    if (saved && (saved === "zh" || saved === "en")) {
      setLanguage(saved)
    } else {
      setLanguage(detectBrowserLanguage())
    }
  }, [])

  useEffect(() => {
    if (mounted) {
      localStorage.setItem("preferred-language", language)
    }
  }, [language, mounted])

  const t = (key: TranslationKey): string => translations[language][key]

  return <LanguageContext.Provider value={{ language, setLanguage, t }}>{children}</LanguageContext.Provider>
}

export function useLanguage() {
  const context = useContext(LanguageContext)
  if (context === undefined) {
    throw new Error("useLanguage must be used within a LanguageProvider")
  }
  return context
}

// SEO Translations
export const seoTranslations = {
  zh: {
    title: "PDF转图片工具 - 免费在线批量转换器",
    description: "专业的PDF转图片在线工具，支持批量处理、OCR文字识别、页面合并等功能。完全免费，隐私安全，无需注册，立即开始转换！",
    keywords: "PDF转图片,免费PDF转换器,在线PDF转图片,批量PDF处理,PDF转PNG工具,PDF转JPEG转换,OCR文字识别,PDF页面合并,无水印PDF转换,隐私安全转换,PDF文字提取,多格式PDF转换,PDF转GIF动图,免费在线工具,PDF批量转换器",
    ogTitle: "免费PDF转图片工具 - 批量处理无需注册",
    ogDescription: "专业PDF转图片转换器，支持批量处理、OCR识别、页面合并。完全免费使用，隐私安全，立即体验！",
    twitterTitle: "免费PDF转图片批量转换器",
    twitterDescription: "专业在线PDF转图片工具，批量处理、OCR识别、隐私安全。完全免费，无需注册，立即开始！",
    structuredDataName: "PDF转图片批量处理工具",
    structuredDataDescription: "免费的在线PDF转图片转换工具，支持批量处理、OCR文字提取、页面合并等多种功能",
    canonicalUrl: "https://www.pdf2img.top/",
  },
  en: {
    title: "Free PDF to Image Converter - Batch Processing Tool",
    description:
      "Professional online PDF to image converter with batch processing, OCR text extraction, and page merging. Completely free, privacy-safe, no registration required. Start converting now!",
    keywords: "PDF to image converter,free PDF converter,online PDF to image,batch PDF processing,PDF to PNG converter,PDF to JPEG tool,OCR text extraction,PDF page merge,privacy safe converter,bulk PDF conversion,PDF text recognition,multi-format PDF converter,PDF to GIF animation,free online tool,secure PDF processing",
    ogTitle: "Free PDF to Image Converter - No Registration Required",
    ogDescription:
      "Professional PDF to image converter with batch processing, OCR extraction, and page merging. Completely free, privacy-safe. Start converting now!",
    twitterTitle: "Free PDF to Image Batch Converter",
    twitterDescription: "Professional online PDF to image tool with batch processing, OCR recognition, privacy protection. Completely free, no registration. Start now!",
    structuredDataName: "PDF to Image Batch Converter",
    structuredDataDescription: "Free online PDF to image conversion tool with batch processing, OCR text extraction, page merging and multiple format support",
    canonicalUrl: "https://www.pdf2img.top/en",
  },
}
